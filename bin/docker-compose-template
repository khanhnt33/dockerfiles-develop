#!/bin/bash

MYPATH=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
NAME=`basename "$PWD"`

if [ -z "$1" ]; then
    echo "template name (ex. php) required"
    exit -1
fi

if [ -z "$2" ]; then
    echo "version required"
    exit -1
fi

if [ -z "$3" ]; then
    echo "a hostname is required (or multiple comma-separated without space)"
    exit -1
fi

TEMPLATE="$1"
export VERSION="$2"
export HOST="$3"
export WEB_ROOT="$PWD"
export WWW_DATA_UID=${UID}
export WWW_DATA_GID=`id -g $USER`
export COMPOSE_OPTIONS="-e VERSION=$VERSION -e HOST=$HOST -e WEB_ROOT=$WEB_ROOT -e WWW_DATA_UID=$WWW_DATA_UID -e WWW_DATA_GID=$WWW_DATA_GID"

docker-compose --file "$MYPATH/docker-compose.$TEMPLATE.yml" --project-directory "$PWD" --project-name "$NAME" run --rm main
